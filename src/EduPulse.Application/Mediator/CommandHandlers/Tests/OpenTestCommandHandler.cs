using EduPulse.Application.Common.Mediator;
using EduPulse.Application.Mediator.Commands.Tests;
using EduPulse.Domain.Common;
using EduPulse.Domain.Entities;
using EduPulse.Domain.Enums;

namespace EduPulse.Application.Mediator.CommandHandlers.Tests;

public class OpenTestCommandHandler : CommandHandlerBase<OpenTestCommand>
{
    private readonly IRepository<TestEntity> _testsRepository;

    public OpenTestCommandHandler(IRepository<TestEntity> testsRepository)
    {
        _testsRepository = testsRepository;
    }

    public override async Task Handle(OpenTestCommand command, CancellationToken cancellationToken)
    {
        var testEntity = await _testsRepository.SingleAsync(test => test.Id == command.Id, cancellationToken);

        testEntity.Status = TestStatus.Opened;

        await _testsRepository.UpdateAsync(testEntity, cancellationToken);
    }
}